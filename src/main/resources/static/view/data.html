<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>数据看板</title>
    <!-- 引入刚刚下载的 ECharts 文件 -->
    <link rel="icon" type="image/x-icon" href="../img/data.svg">
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="../css/data_style.css" rel="stylesheet">
    <script src="../js/echarts.js"></script>
    <script src="../js/jquery-1.10.2.min.js"></script>
    <style>
        .scroll-box::-webkit-scrollbar {
            width: 0;
            height: 0;
        }
    </style>
</head>
<body>


<!-- 为 ECharts 准备一个定义了宽高的 DOM -->
<div class="content-wrap">
    <div class="main">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <div class="jumbotron">
                        <h1 class="display-4">数据看板 <span class="badge badge-success">运行中</span></h1>

                        <p class="lead">数据集皆来源于<a href="https://www.eastmoney.com/" target="_blank"
                                                  style="color:blue;text-decoration: underline;">东方财富网</a>，均为符合该网站要求的合法爬虫。
                        </p>
                        <hr class="my-4">
                        <p>The dataset is sourced from <a href="https://www.eastmoney.com/" target="_blank"
                                                          style="color:blue;text-decoration: underline;">#eastmoney</a>
                            website and is a legitimate crawler that meets the requirements of the website.</p>
                        <button type="button" class="btn btn-light"><a href="https://holdenxiao.cn">返回</a></button>
                    </div>
                </div>

            </div>
            <!-- /# row -->
            <section id="main-content">
                <!--第一栏四个图标-->
                <div th:each="oneRow : ${info.t1}">
                    <div class="row">
                        <div class="col-lg-3">
                            <div class="card">
                                <div class="stat-widget-one">
                                    <div class="stat-icon dib"><i class='bx bxs-dollar-circle' style="color:green"></i>
                                    </div>
                                    <div class="stat-content dib">
                                        <div class="stat-text">主力净流入（万）</div>
                                        <div class="stat-digit">￥<span th:text="${oneRow.mainFlow}"></span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="card">
                                <div class="stat-widget-one">
                                    <div class="stat-icon dib"><i class='bx bx-dollar-circle' style="color:red"></i>
                                    </div>
                                    <div class="stat-content dib">
                                        <div class="stat-text">散户净流入（万）</div>
                                        <div class="stat-digit">￥<span th:text="${oneRow.smallFlow}"></span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="card">
                                <div class="stat-widget-one">
                                    <div class="stat-icon dib"><i class='bx bxs-user-check' style="color:green"></i>
                                    </div>
                                    <div class="stat-content dib">
                                        <div class="stat-text">外盘（万）</div>
                                        <div class="stat-digit">￥<span th:text="${oneRow.outside}"></span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="card">
                                <div class="stat-widget-one">
                                    <div class="stat-icon dib"><i class='bx bxs-user-x' style="color:red"></i></div>
                                    <div class="stat-content dib">
                                        <div class="stat-text">内盘（万）</div>
                                        <div class="stat-digit">￥<span th:text="${oneRow.inner}"></span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--第二栏四个图标-->
                    <div class="row">
                        <div class="col-lg-3">
                            <div class="card">
                                <div class="stat-widget-one">
                                    <div class="stat-icon dib"><i class='bx bx-trending-up' style="color:#1cde0f"></i>
                                    </div>
                                    <div class="stat-content dib">
                                        <div class="stat-text">最佳涨幅</div>
                                        <div class="stat-digit"><span th:text="${oneRow.upRate}"></span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="card">
                                <div class="stat-widget-one">
                                    <div class="stat-icon dib"><i class='bx bx-trending-down' style="color:#c05533"></i>
                                    </div>
                                    <div class="stat-content dib">
                                        <div class="stat-text">最强跌幅</div>
                                        <div class="stat-digit"><span th:text="${oneRow.downRate}"></span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="card">
                                <div class="stat-widget-one">
                                    <div class="stat-icon dib"><i class='bx bx-coin-stack' style="color:#9719c0"></i>
                                    </div>
                                    <div class="stat-content dib">
                                        <div class="stat-text">成交量（万）</div>
                                        <div class="stat-digit"><span th:text="${oneRow.dealVol}"></span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="card">
                                <div class="stat-widget-one">
                                    <div class="stat-icon dib"><i class='bx bx-dollar' style="color:#be260e"></i></div>
                                    <div class="stat-content dib">
                                        <div class="stat-text">最高价</div>
                                        <div class="stat-digit">￥<span th:text="${oneRow.highest}"></span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <div id="t1" style="width: 100%;height: 450px"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div class="card">

                            <div class="card-body">
                                <div id="t2" style="width: 100%;height: 450px"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-4">
                        <div class="card" style="height: 500px">
                            <div class="card-body">
                                <div id="t3" style="width: 100%;height: 440px"></div>
                            </div>
                        </div>
                    </div>
                    <!-- /# column -->
                    <div class="col-lg-8">
                        <div class="card" style="height: 500px">
                            <div class="card-title pr">
                                <h4><b>今日涨幅排行</b></h4>
                            </div>
                            <div class="scroll-box" style="overflow: auto">
                                <table class="table table-striped">
                                    <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">名称</th>
                                        <th scope="col">收盘价</th>
                                        <th scope="col">涨幅</th>
                                        <th scope="col">成交量</th>
                                        <th scope="col">市盈率</th>
                                        <th scope="col">所属板块</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="oneRow : ${info.t3r}">
                                        <th scope="row" th:text="${oneRow.code}"></th>
                                        <td th:text="${oneRow.name}"></td>
                                        <td th:text="${oneRow.currentPrice}"></td>
                                        <td th:text="${oneRow.upDownRate}"></td>
                                        <td th:text="${oneRow.dealAmount}"></td>
                                        <td th:text="${oneRow.pe}"></td>
                                        <td th:text="${oneRow.industry}"></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>

                        </div>
                    </div>
                    <!-- /# column -->
                </div>
                <!-- /# row -->
                <div class="row" th:each="oneRow : ${info.board}">
                    <div class="col-lg-3">
                        <div class="card p-0">
                            <div class="stat-widget-three home-widget-three">
                                <div class="stat-icon bg-facebook">
                                    <i class='bx bxs-dollar-circle'></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-digit" th:text="${oneRow.sh}"></div>
                                    <div class="stat-text">沪板</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="card p-0">
                            <div class="stat-widget-three home-widget-three">
                                <div class="stat-icon bg-youtube">
                                    <i class='bx bxs-tennis-ball'></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-digit" th:text="${oneRow.sz}"></div>
                                    <div class="stat-text">深板</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="card p-0">
                            <div class="stat-widget-three home-widget-three">
                                <div class="stat-icon bg-twitter">
                                    <i class='bx bxs-plane'></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-digit" th:text="${oneRow.bj}"></div>
                                    <div class="stat-text">京板</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="card p-0">
                            <div class="stat-widget-three home-widget-three">
                                <div class="stat-icon bg-danger">
                                    <i class='bx bxs-game'></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-digit" th:text="${oneRow.cy}"></div>
                                    <div class="stat-text">创业板</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--最新新闻-->
                <div class="row">
                    <div class="col-lg-4">
                        <div class="card" style="">
                            <img src="../img/stock.png" class="card-img-top" alt="...">
                            <div class="card-body">
                                <h5 class="card-title">比亚迪 - 301299</h5>
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">1.今日有利好消息</li>
                                <li class="list-group-item">2.有高管购入</li>
                            </ul>
                            <div class="card-body">
                                <a href="http://quote.eastmoney.com/sz002594.html" class="card-link" target="_blank"
                                   style="color:blue">跳转连接</a>
                            </div>
                        </div>
                        <!-- /# card -->
                    </div>
                    <!-- /# column -->
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-title">
                                <h4><b>各门户最新新闻</b></h4>
                            </div>

                            <div class="recent-comment m-t-15 scroll-box" style="height: 440px;overflow: auto">
                                <div class="media" th:each="oneRow : ${info.news}">
                                    <div class="media-body">
                                        <h4 class="media-heading color-primary"
                                            th:text="${oneRow.agency} +'('+ ${oneRow.code}+')'"></h4>
                                        <p th:text="${oneRow.content}"></p>
                                        <p class="comment-date" th:text="${oneRow.date}">2023-04-27 17:17:45</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /# card -->
                    </div>
                    <!-- /# column -->
                    <div class="col-lg-4">
                        <div class="card" style="height: 500px">
                            <div class="card-title">
                                <h4><b>Timeline</b></h4>
                            </div>
                            <div class="card-body scroll-box" style="overflow: auto">
                                <ul class="timeline">
                                    <li>
                                        <div class="timeline-badge primary"><i class="fa fa-smile-o">1</i></div>
                                        <div class="timeline-panel">
                                            <div class="timeline-heading">
                                                <h5 class="timeline-title">School promote video sharing</h5>
                                            </div>
                                            <div class="timeline-body">
                                                <p>10 minutes ago</p>
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="timeline-badge warning"><i class="fa fa-sun-o">2</i></div>
                                        <div class="timeline-panel">
                                            <div class="timeline-heading">
                                                <h5 class="timeline-title">Ready our school website and online
                                                    service</h5>
                                            </div>
                                            <div class="timeline-body">
                                                <p>20 minutes ago</p>
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="timeline-badge danger"><i class="fa fa-times-circle-o">3</i>
                                        </div>
                                        <div class="timeline-panel">
                                            <div class="timeline-heading">
                                                <h5 class="timeline-title">Routine pubish our website form
                                                    10/03/2017 </h5>
                                            </div>
                                            <div class="timeline-body">
                                                <p>30 minutes ago</p>
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="timeline-badge success"><i class="fa fa-check-circle-o"></i>
                                        </div>
                                        <div class="timeline-panel">
                                            <div class="timeline-heading">
                                                <h5 class="timeline-title">Principle quotation publish our website
                                                </h5>
                                            </div>
                                            <div class="timeline-body">
                                                <p>15 minutes ago</p>
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="timeline-badge warning"><i class="fa fa-sun-o"></i></div>
                                        <div class="timeline-panel">
                                            <div class="timeline-heading">
                                                <h5 class="timeline-title">Class schedule publish our website</h5>
                                            </div>
                                            <div class="timeline-body">
                                                <p>20 minutes ago</p>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!-- /# card -->
                    </div>
                </div>
                <!-- /# row -->
                <div class="row">
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-title">
                                <h4><b>Top 5</b></h4>
                            </div>
                            <div id="forecast" style="width: 100%;height: 428px">

                            </div>
                        </div>
                    </div>
                    <div class="col-lg-8">
                        <div class="card" style="height: 500px">
                            <div class="card-title pr">
                                <h4><b>今日行业研报</b></h4>
                            </div>
                            <div class="card-body scroll-box" style="overflow: auto">
                                <div class="table-responsive">
                                    <table class="table student-data-table m-t-20">
                                        <thead>
                                        <tr>
                                            <th>所在行业</th>
                                            <th>报告内容</th>
                                            <th>评级参考</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr th:each="oneRow : ${info.industry}">
                                            <td><span style="color:#1cde0f" th:text="${oneRow.name}"></span></td>
                                            <td th:text="${oneRow.reportName}"></td>
                                            <td th:switch="${oneRow.rank}">
                                                <span class="badge badge-danger" th:case="3">牛↑↑</span>
                                                <span class="badge badge-danger" th:case="2">牛↑</span>
                                                <span class="badge badge-warning" th:case="0">中性</span>
                                                <span class="badge badge-success" th:case="-2">熊↓↓</span>
                                                <span class="badge badge-success" th:case="1">熊↓</span>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /# column -->
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="footer">
                            <p>2023 © 个人所有. - <a href="https://holdenxiao.cn">holdenxiao.cn</a></p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>

<script type="text/javascript" th:inline="javascript">
    $(function () {
        var info = [[${info.t3l}]]
        t1([[${info.index}]]);
        t2([[${info.t2}]]);
        t3(info);
        forecast([[${info.chance}]]);
    })

    function t1(info) {
        var chartDom = document.getElementById('t1');
        var myChart = echarts.init(chartDom);
        var option;

        const upColor = '#ec0000';
        const upBorderColor = '#8A0000';
        const downColor = '#00da3c';
        const downBorderColor = '#008F28';

        const data0 = splitData(info.map(item => {
            const dateString = item.date.replace(/-/g, '/');
            const open = parseFloat(item.open);
            const close = parseFloat(item.close);
            const lowest = parseFloat(item.lowest);
            const highest = parseFloat(item.highest);
            return [dateString, open, close, lowest, highest];
        }));


        function splitData(rawData) {
            const categoryData = [];
            const values = [];
            for (var i = 0; i < rawData.length; i++) {
                categoryData.push(rawData[i].splice(0, 1)[0]);
                values.push(rawData[i]);
            }
            return {
                categoryData: categoryData,
                values: values
            };
        }

        function calculateMA(dayCount) {
            var result = [];
            for (var i = 0, len = data0.values.length; i < len; i++) {
                if (i < dayCount) {
                    result.push('-');
                    continue;
                }
                var sum = 0;
                for (var j = 0; j < dayCount; j++) {
                    sum += +data0.values[i - j][1];
                }
                result.push(sum / dayCount);
            }
            return result;
        }

        option = {
            title: {
                text: '上证指数',
                left: 0
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross'
                }
            },
            legend: {
                data: ['日K', 'MA5', 'MA20']
            },
            grid: {
                left: '10%',
                right: '10%',
                bottom: '15%'
            },
            xAxis: {
                type: 'category',
                data: data0.categoryData,
                boundaryGap: false,
                axisLine: {onZero: false},
                splitLine: {show: false},
                min: 'dataMin',
                max: 'dataMax'
            },
            yAxis: {
                scale: true,
                splitArea: {
                    show: true
                }
            },
            dataZoom: [
                {
                    type: 'inside',
                    start: 50,
                    end: 100
                },
                {
                    show: true,
                    type: 'slider',
                    top: '90%',
                    start: 50,
                    end: 100
                }
            ],
            series: [
                {
                    name: '日K',
                    type: 'candlestick',
                    data: data0.values,
                    itemStyle: {
                        color: upColor,
                        color0: downColor,
                        borderColor: upBorderColor,
                        borderColor0: downBorderColor
                    },
                    markPoint: {
                        label: {
                            formatter: function (param) {
                                return param != null ? Math.round(param.value) + '' : '';
                            }
                        },
                        data: [
                            {
                                name: 'highest value',
                                type: 'max',
                                valueDim: 'highest'
                            },
                            {
                                name: 'lowest value',
                                type: 'min',
                                valueDim: 'lowest'
                            },
                            {
                                name: 'average value on close',
                                type: 'average',
                                valueDim: 'close'
                            }
                        ],
                        tooltip: {
                            formatter: function (param) {
                                return param.name + '<br>' + (param.data.coord || '');
                            }
                        }
                    },
                    markLine: {
                        symbol: ['none', 'none'],
                        data: [
                            [
                                {
                                    name: 'from lowest to highest',
                                    type: 'min',
                                    valueDim: 'lowest',
                                    symbol: 'circle',
                                    symbolSize: 10,
                                    label: {
                                        show: false
                                    },
                                    emphasis: {
                                        label: {
                                            show: false
                                        }
                                    }
                                },
                                {
                                    type: 'max',
                                    valueDim: 'highest',
                                    symbol: 'circle',
                                    symbolSize: 10,
                                    label: {
                                        show: false
                                    },
                                    emphasis: {
                                        label: {
                                            show: false
                                        }
                                    }
                                }
                            ],
                            {
                                name: 'min line on close',
                                type: 'min',
                                valueDim: 'close'
                            },
                            {
                                name: 'max line on close',
                                type: 'max',
                                valueDim: 'close'
                            }
                        ]
                    }
                },
                {
                    name: 'MA5',
                    type: 'line',
                    data: calculateMA(5),
                    smooth: true,
                    lineStyle: {
                        opacity: 0.5
                    }
                },
                {
                    name: 'MA20',
                    type: 'line',
                    data: calculateMA(20),
                    smooth: true,
                    lineStyle: {
                        opacity: 0.5
                    }
                }
            ]
        };

        option && myChart.setOption(option);
    }

    function t2(info) {
        var chartDom = document.getElementById('t2');
        var myChart = echarts.init(chartDom);
        var option;

        var xAxisData = [];
        var data1 = [];
        var data2 = [];
        for (var i = 0; i < info.length; i++) {
            xAxisData.push(info[i].ds);
            data1.push(info[i].big);
            data2.push(info[i].small);
        }
        option = {
            title: {
                text: '近14天成交量占比(万)'
            },
            legend: {
                data: ['流入', '流出']
            },
            toolbox: {
                // y: 'bottom',
                feature: {}
            },
            tooltip: {},
            xAxis: {
                data: xAxisData,
                splitLine: {
                    show: false
                }
            },
            yAxis: {},
            series: [
                {
                    name: '流入',
                    type: 'bar',
                    data: data1,
                    emphasis: {
                        focus: 'series'
                    },
                    animationDelay: function (idx) {
                        return idx * 10;
                    }
                },
                {
                    name: '流出',
                    type: 'bar',
                    data: data2,
                    emphasis: {
                        focus: 'series'
                    },
                    animationDelay: function (idx) {
                        return idx * 10;
                    }
                }
            ],
            animationEasing: 'elasticOut',
            animationDelayUpdate: function (idx) {
                return idx * 5;
            }
        };

        option && myChart.setOption(option);
    }

    function t3(info) {
        var chartDom = document.getElementById('t3');
        var myChart = echarts.init(chartDom);
        var option;

        option = {
            legend: {
                show: false
            },
            title: {
                text: '各板块占比'
            },
            toolbox: {
                show: true,
                feature: {
                    mark: {show: true}
                }
            },
            series: [
                {
                    name: 'Nightingale Chart',
                    type: 'pie',
                    radius: [10, 150],
                    center: ['50%', '50%'],
                    roseType: 'area',
                    itemStyle: {
                        borderRadius: 8
                    },
                    data: info

                }
            ]
        }
        ;

        option && myChart.setOption(option);
    }

    function forecast(info) {
        let result = info.map(function (data) {
            return {
                value: [
                    parseFloat(data.totalScore),
                    parseFloat(data.probability),
                    parseFloat(data.rankRatio),
                    parseFloat(data.increase)
                ],
                name: data.code
            };
        });
        console.info(result)

        var chartDom = document.getElementById('forecast');
        var myChart = echarts.init(chartDom);
        var option;


        option = {
            legend: {},
            radar: {
                indicator: [
                    {name: '评分', max: 100},
                    {name: '上涨概率', max: 100},
                    {name: '上涨幅度', max: 100},
                    {name: '超越', max: 1}
                ]
            },
            series: [
                {
                    type: 'radar',
                    data: result

                }
            ]
        };

        option && myChart.setOption(option);
    }


</script>
</body>
</html>